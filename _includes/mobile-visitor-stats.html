<!-- ç§»åŠ¨ç«¯å‹å¥½çš„è®¿å®¢ç»Ÿè®¡ç»„ä»¶ -->
<div id="mobile-visitor-stats" class="mobile-stats-container">
  <div class="mobile-stats-box">
    <div class="mobile-stats-grid">
      <div class="mobile-stat-item">
        <span class="mobile-stat-icon">ğŸ‘¥</span>
        <div class="mobile-stat-content">
          <div class="mobile-stat-value" id="mobile-visitor-count">...</div>
          <div class="mobile-stat-label">è®¿å®¢</div>
        </div>
      </div>
      
      <div class="mobile-stat-item">
        <span class="mobile-stat-icon">ğŸ“…</span>
        <div class="mobile-stat-content">
          <div class="mobile-stat-value" id="mobile-today-count">...</div>
          <div class="mobile-stat-label">ä»Šæ—¥</div>
        </div>
      </div>
      
      <div class="mobile-stat-item">
        <span class="mobile-stat-icon">ğŸŒ</span>
        <div class="mobile-stat-content">
          <div class="mobile-stat-value" id="mobile-online-count">...</div>
          <div class="mobile-stat-label">åœ¨çº¿</div>
        </div>
      </div>
    </div>
    
    <div class="mobile-location-info">
      <span class="location-emoji">ğŸ“</span>
      <span id="mobile-location-text">è·å–ä½ç½®ä¸­...</span>
    </div>
  </div>
</div>

<style>
.mobile-stats-container {
  margin: 15px 0;
  display: none; /* é»˜è®¤éšè—ï¼Œé€šè¿‡åª’ä½“æŸ¥è¯¢æ˜¾ç¤º */
}

.mobile-stats-box {
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  color: white;
  border-radius: 15px;
  padding: 16px;
  box-shadow: 0 4px 20px rgba(79, 172, 254, 0.3);
  backdrop-filter: blur(10px);
}

.mobile-stats-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-bottom: 12px;
}

.mobile-stat-item {
  display: flex;
  align-items: center;
  gap: 8px;
  background: rgba(255, 255, 255, 0.15);
  border-radius: 10px;
  padding: 10px 8px;
  backdrop-filter: blur(5px);
}

.mobile-stat-icon {
  font-size: 20px;
  flex-shrink: 0;
}

.mobile-stat-content {
  flex: 1;
  min-width: 0;
}

.mobile-stat-value {
  font-size: 16px;
  font-weight: 700;
  line-height: 1.2;
  color: #fff;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.mobile-stat-label {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.8);
  text-transform: uppercase;
  letter-spacing: 0.3px;
  margin-top: 1px;
}

.mobile-location-info {
  display: flex;
  align-items: center;
  gap: 6px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  padding: 8px 10px;
  font-size: 13px;
  color: rgba(255, 255, 255, 0.95);
}

.location-emoji {
  font-size: 14px;
  flex-shrink: 0;
}

#mobile-location-text {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  min-width: 0;
}

/* å“åº”å¼æ˜¾ç¤ºæ§åˆ¶ */
@media (max-width: 768px) {
  .visitor-stats-container {
    display: none; /* éšè—æ¡Œé¢ç‰ˆ */
  }
  
  .mobile-stats-container {
    display: block; /* æ˜¾ç¤ºç§»åŠ¨ç‰ˆ */
  }
}

@media (max-width: 480px) {
  .mobile-stats-box {
    padding: 12px;
  }
  
  .mobile-stats-grid {
    gap: 8px;
    margin-bottom: 10px;
  }
  
  .mobile-stat-item {
    padding: 8px 6px;
  }
  
  .mobile-stat-icon {
    font-size: 18px;
  }
  
  .mobile-stat-value {
    font-size: 14px;
  }
  
  .mobile-stat-label {
    font-size: 10px;
  }
  
  .mobile-location-info {
    padding: 6px 8px;
    font-size: 12px;
  }
}

/* åŠ è½½åŠ¨ç”» */
.mobile-loading {
  animation: mobilePulse 1.5s ease-in-out infinite;
}

@keyframes mobilePulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

/* é”™è¯¯çŠ¶æ€ */
.mobile-error {
  color: rgba(255, 255, 255, 0.6);
  font-style: italic;
}

/* æˆåŠŸæ›´æ–°åŠ¨ç”» */
.mobile-updated {
  animation: mobileSuccess 0.6s ease-out;
}

@keyframes mobileSuccess {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}
</style>

<script>
// ç§»åŠ¨ç«¯è®¿å®¢ç»Ÿè®¡è„šæœ¬
(function() {
  const MobileVisitorStats = {
    init() {
      this.syncWithDesktopStats();
      this.setupMobileSpecificFeatures();
    },

    // åŒæ­¥æ¡Œé¢ç‰ˆç»Ÿè®¡æ•°æ®
    syncWithDesktopStats() {
      // ç­‰å¾…æ¡Œé¢ç‰ˆåŠ è½½å®Œæˆ
      const checkDesktopStats = () => {
        if (window.visitorStats || window.VisitorStats) {
          this.updateMobileDisplay();
        } else {
          setTimeout(checkDesktopStats, 100);
        }
      };
      checkDesktopStats();
    },

    // æ›´æ–°ç§»åŠ¨ç«¯æ˜¾ç¤º
    updateMobileDisplay() {
      try {
        // è·å–æ¡Œé¢ç‰ˆçš„æ•°æ®
        const visitorCount = document.getElementById('visitor-count')?.textContent || '...';
        const todayCount = document.getElementById('today-count')?.textContent || '...';
        const onlineCount = document.getElementById('online-count')?.textContent || '...';
        const locationText = document.getElementById('location-text')?.textContent || 'è·å–ä½ç½®ä¸­...';

        // æ›´æ–°ç§»åŠ¨ç«¯æ˜¾ç¤º
        this.updateElement('mobile-visitor-count', visitorCount);
        this.updateElement('mobile-today-count', todayCount);
        this.updateElement('mobile-online-count', onlineCount);
        this.updateElement('mobile-location-text', this.shortenLocation(locationText));

        // å®šæœŸåŒæ­¥
        setTimeout(() => this.updateMobileDisplay(), 5000);
      } catch (error) {
        console.warn('ç§»åŠ¨ç«¯ç»Ÿè®¡åŒæ­¥å¤±è´¥:', error);
      }
    },

    // ç¼©çŸ­ä½ç½®æ–‡æœ¬ä»¥é€‚åº”ç§»åŠ¨ç«¯
    shortenLocation(text) {
      if (!text || text.includes('å¤±è´¥') || text.includes('è·å–')) {
        return text;
      }
      
      // å¦‚æœå¤ªé•¿ï¼Œåªæ˜¾ç¤ºåŸå¸‚å’Œå›½å®¶
      const parts = text.split(', ');
      if (parts.length > 2 && text.length > 20) {
        return `${parts[0]}, ${parts[parts.length - 1]}`;
      }
      
      return text.length > 25 ? text.substring(0, 22) + '...' : text;
    },

    // æ›´æ–°å…ƒç´ 
    updateElement(id, content) {
      const element = document.getElementById(id);
      if (element && element.textContent !== content) {
        element.textContent = content;
        element.classList.add('mobile-updated');
        setTimeout(() => {
          element.classList.remove('mobile-updated');
        }, 600);
      }
    },

    // è®¾ç½®ç§»åŠ¨ç«¯ç‰¹å®šåŠŸèƒ½
    setupMobileSpecificFeatures() {
      // è§¦æ‘¸äº¤äº’
      const mobileBox = document.querySelector('.mobile-stats-box');
      if (mobileBox) {
        mobileBox.addEventListener('touchstart', function() {
          this.style.transform = 'scale(0.98)';
        });
        
        mobileBox.addEventListener('touchend', function() {
          this.style.transform = 'scale(1)';
        });
      }

      // åŒå‡»åˆ·æ–°
      let lastTap = 0;
      if (mobileBox) {
        mobileBox.addEventListener('touchend', (e) => {
          const currentTime = new Date().getTime();
          const tapLength = currentTime - lastTap;
          if (tapLength < 500 && tapLength > 0) {
            // åŒå‡»æ£€æµ‹åˆ°ï¼Œåˆ·æ–°ç»Ÿè®¡
            this.refreshStats();
          }
          lastTap = currentTime;
        });
      }
    },

    // åˆ·æ–°ç»Ÿè®¡
    refreshStats() {
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      const elements = ['mobile-visitor-count', 'mobile-today-count', 'mobile-online-count'];
      elements.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.classList.add('mobile-loading');
        }
      });

      // è§¦å‘æ¡Œé¢ç‰ˆåˆ·æ–°
      if (window.visitorStats && window.visitorStats.fetchLocationData) {
        window.visitorStats.fetchLocationData();
      }

      // 1ç§’åç§»é™¤åŠ è½½çŠ¶æ€
      setTimeout(() => {
        elements.forEach(id => {
          const el = document.getElementById(id);
          if (el) {
            el.classList.remove('mobile-loading');
          }
        });
      }, 1000);
    }
  };

  // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–ç§»åŠ¨ç«¯ç»Ÿè®¡
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => MobileVisitorStats.init());
  } else {
    MobileVisitorStats.init();
  }

  // å¯¼å‡ºåˆ°å…¨å±€ä½œç”¨åŸŸ
  window.MobileVisitorStats = MobileVisitorStats;
})();
</script>
